<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Management System - Login</title>
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Tailwind gray-50 */
        }
        /* Style for active sidebar link */
        .sidebar-link.active {
            background-color: #e0f2fe; /* Tailwind sky-100 */
            color: #0ea5e9; /* Tailwind sky-500 */
            font-weight: 600;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Custom styling for Flatpickr */
        .flatpickr-calendar {
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
        }

        /* Admin-only elements (hidden by default for non-admin users) */
        .admin-only.hidden {
            display: none;
        }
        /* Custom table styling */
        thead th {
            background-color: #f1f5f9; /* Tailwind slate-100 */
            position: sticky;
            top: 0;
            z-index: 10;
        }
        /* Ensure table container allows scrolling */
        .table-container {
            max-height: none; /* Allow tables to be as tall as needed */
            overflow: auto; /* Enable both horizontal and vertical scrolling */
            width: 100%;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
        }

        /* Make table headers sticky */
        .table-container thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #2563eb !important;
            color: white !important;
        }

        /* Ensure table cells don't wrap and have proper padding */
        .table-container td,
        .table-container th {
            white-space: nowrap;
            padding: 0.75rem 1rem;
        }
         /* Center login form */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e5e7eb; /* Tailwind gray-200 */
        }
        /* Fixed height for chart containers */
        .chart-container {
            height: 18rem; /* Approx h-72 */
            position: relative; /* Needed for Chart.js responsiveness */
            width: 100%;
            margin-bottom: 1rem;
        }

        /* Ensure charts are visible */
        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Simplified Time Selection Styles */
        .clock-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
            overflow-y: auto;
            padding: 20px 0;
        }

        .clock-modal-content {
            background: white;
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 300px;
            max-width: 90vw;
            max-height: 90vh;
            animation: modalFadeIn 0.3s ease;
            margin: auto;
            overflow-y: auto;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .clock-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .clock-modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .clock-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .clock-modal-close:hover {
            color: #4f46e5;
        }

        .hour-button {
            background-color: #f3f4f6;
            color: #1f2937;
            border: none;
            border-radius: 6px;
            padding: 8px 0;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            margin: 2px;
        }

        .hour-button:hover {
            background-color: #e5e7eb;
            transform: translateY(-1px);
        }

        .hour-button.selected {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3);
        }

        .hour-button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="overflow-hidden"> <div id="login-screen" class="login-container">
        <div class="bg-white p-8 md:p-12 rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-center items-center mb-8">
                <div class="bg-indigo-600 p-3 rounded-lg shadow-lg">
                    <i class="fas fa-users text-white text-4xl"></i>
                </div>
                <div class="ml-3">
                    <h1 class="text-2xl font-bold text-indigo-600">HR System</h1>
                    <p class="text-sm text-gray-500">Employee Management</p>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">HR System Login</h2>
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="username" name="username" required
                           class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                           placeholder="Enter username">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" name="password" required
                           class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                           placeholder="Enter password">
                </div>
                <div id="login-error" class="text-red-500 text-sm mb-4 text-center hidden">
                    Invalid username or password.
                </div>
                <button type="submit"
                        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-md shadow transition duration-150">
                    Login
                </button>
            </form>
             <!-- Login guide removed as requested -->
        </div>
    </div>

    <div id="app-container" class="flex h-screen overflow-hidden hidden">
        <!-- Mobile menu button -->
        <div class="fixed top-4 left-4 z-20 md:hidden">
            <button id="mobile-menu-button" class="bg-white p-2 rounded-md shadow-md text-gray-700 hover:bg-gray-100">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>

        <div class="flex w-full h-full">
            <aside id="sidebar" class="w-64 bg-white shadow-md flex flex-col no-scrollbar overflow-y-auto fixed md:sticky top-0 h-full z-10 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
                <div class="p-6 text-2xl font-bold text-gray-700 border-b flex justify-between items-center">
                    <span>Company HR</span>
                    <button id="close-sidebar" class="md:hidden text-gray-500 hover:text-gray-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <nav class="mt-6 flex-1">
                    <ul>
                        <li id="nav-item-dashboard" class="admin-only">
                            <a href="#" id="nav-dashboard" class="sidebar-link active flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('dashboard')">
                                <i class="fas fa-tachometer-alt w-5 mr-3"></i> Dashboard
                            </a>
                        </li>
                        <li id="nav-item-employee-profile" class="hidden">
                            <a href="#" id="nav-employee-profile" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('employee-profile')">
                                <i class="fas fa-user w-5 mr-3"></i> My Profile
                            </a>
                        </li>
                        <li id="nav-item-my-requests" class="hidden">
                            <a href="#" id="nav-my-requests" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('my-requests')">
                                <i class="fas fa-clipboard-list w-5 mr-3"></i> My Requests
                            </a>
                        </li>
                        <li id="nav-item-manager-dashboard" class="hidden">
                            <a href="#" id="nav-manager-dashboard" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('manager-dashboard')">
                                <i class="fas fa-user-tie w-5 mr-3"></i> Manager Dashboard
                            </a>
                        </li>
                        <li id="nav-item-database" class="admin-only">
                            <a href="#" id="nav-database" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('database')">
                                <i class="fas fa-users w-5 mr-3"></i> Employee Database
                            </a>
                        </li>
                        <li id="nav-item-leaves" class="admin-only">
                            <a href="#" id="nav-leaves" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('leaves')">
                                <i class="fas fa-calendar-alt w-5 mr-3"></i> Employee Leaves
                            </a>
                        </li>
                        <li id="nav-item-excuses" class="admin-only">
                            <a href="#" id="nav-excuses" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('excuses')">
                                <i class="fas fa-clock w-5 mr-3"></i> Employee Excuses
                            </a>
                        </li>
                        <li id="nav-item-overtime" class="admin-only">
                            <a href="#" id="nav-overtime" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('overtime')">
                                <i class="fas fa-business-time w-5 mr-3"></i> Employee Overtime
                            </a>
                        </li>
                        <li id="nav-item-penalties" class="admin-only">
                            <a href="#" id="nav-penalties" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('penalties')">
                                <i class="fas fa-exclamation-triangle w-5 mr-3"></i> Employee Penalties
                            </a>
                        </li>
                        <li id="nav-item-salary" class="admin-only">
                            <a href="#" id="nav-salary" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('salary')">
                                <i class="fas fa-dollar-sign w-5 mr-3"></i> Salary Details
                            </a>
                        </li>
                        <li id="nav-item-payroll" class="admin-only">
                            <a href="#" id="nav-payroll" class="sidebar-link flex items-center px-6 py-3 bg-yellow-100 text-red-600 font-bold hover:bg-gray-100 transition duration-150" onclick="showSection('payroll')">
                                <i class="fas fa-money-bill-wave w-5 mr-3"></i> Payroll
                            </a>
                        </li>
                        <li id="nav-item-settings" class="admin-only">
                            <a href="#" id="nav-settings" class="sidebar-link flex items-center px-6 py-3 text-gray-600 hover:bg-gray-100 transition duration-150" onclick="showSection('settings')">
                                <i class="fas fa-cog w-5 mr-3"></i> Settings
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="p-6 border-t">
                    <button onclick="logout()" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150">
                        <i class="fas fa-sign-out-alt mr-2"></i> Logout
                    </button>
                </div>
            </aside>

            <main class="flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50 relative">
                <!-- Notification Bell -->
                <div class="absolute top-4 right-4 z-20">
                    <div class="relative">
                        <button id="notification-bell" class="bg-white p-2 rounded-full shadow-md text-gray-700 hover:bg-gray-100 focus:outline-none">
                            <i class="fas fa-bell text-xl"></i>
                            <span id="notification-badge" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
                        </button>
                        <div id="notification-dropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg overflow-hidden z-20 hidden">
                            <div class="py-2">
                                <div class="px-4 py-2 border-b">
                                    <h3 class="text-sm font-semibold text-gray-700">Notifications</h3>
                                </div>
                                <div id="notification-list" class="max-h-64 overflow-y-auto">
                                    <!-- Notifications will be populated here -->
                                    <div class="px-4 py-3 text-sm text-gray-500 text-center">No notifications</div>
                                </div>
                                <div class="px-4 py-2 border-t text-xs text-center">
                                    <button id="clear-notifications" class="text-blue-600 hover:text-blue-800">Clear All</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <section id="dashboard" class="space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>

                    <!-- Dashboard Filters -->
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="dashboard-filter-department" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                                <select id="dashboard-filter-department" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                    <option value="all">All Departments</option>
                                    <!-- Will be populated by JS -->
                                </select>
                            </div>
                            <div>
                                <label for="dashboard-filter-year" class="block text-sm font-medium text-gray-700 mb-1">Year</label>
                                <select id="dashboard-filter-year" class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                    <!-- Will be populated by JS -->
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="apply-dashboard-filters" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                    <i class="fas fa-filter mr-1"></i> Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-2xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">Total Employees</p>
                                    <h3 id="total-employees" class="text-2xl font-semibold text-gray-800">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-user-check text-2xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">Active Employees</p>
                                    <h3 id="active-employees" class="text-2xl font-semibold text-gray-800">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i class="fas fa-calendar-alt text-2xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">On Leave Today</p>
                                    <h3 id="on-leave-today" class="text-2xl font-semibold text-gray-800">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                    <i class="fas fa-user-tie text-2xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-500">Managers</p>
                                    <h3 id="total-managers" class="text-2xl font-semibold text-gray-800">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row 1 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Employees by Department</h2>
                            <div class="chart-container">
                                <canvas id="deptChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Employees by Level</h2>
                            <div class="chart-container">
                                <canvas id="levelChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row 2 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Hiring Trend</h2>
                            <div class="chart-container">
                                <canvas id="hiringChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Leave Distribution by Department</h2>
                            <div class="chart-container">
                                <canvas id="leavesDeptChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row 3 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Gender Distribution</h2>
                            <div class="chart-container">
                                <canvas id="genderChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Age Distribution</h2>
                            <div class="chart-container">
                                <canvas id="ageChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Hiring Chart -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Monthly Hiring (Current Year)</h2>
                        <div class="chart-container" style="height: 24rem;">
                            <canvas id="monthlyHiringChart"></canvas>
                        </div>
                    </div>

                    <!-- Current Time -->
                    <div class="bg-white p-6 rounded-lg shadow text-center">
                        <h2 class="text-lg font-semibold text-gray-800 mb-2">Current Time</h2>
                        <div class="flex justify-center items-center space-x-4">
                            <div class="relative w-32 h-32">
                                <div id="analog-clock" class="w-full h-full rounded-full border-4 border-gray-300 relative">
                                    <div id="hour-hand" class="absolute w-1 h-12 bg-gray-800 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 origin-bottom"></div>
                                    <div id="minute-hand" class="absolute w-0.5 h-16 bg-gray-600 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 origin-bottom"></div>
                                    <div id="second-hand" class="absolute w-0.5 h-16 bg-red-500 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 origin-bottom"></div>
                                    <div class="absolute w-3 h-3 bg-gray-800 rounded-full top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></div>
                                </div>
                            </div>
                            <div>
                                <div id="digital-clock" class="text-4xl font-bold text-gray-800">00:00:00</div>
                                <div id="digital-date" class="text-lg text-gray-600">Monday, Jan 1, 2023</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Employee Profile Section -->
                <section id="employee-profile" class="hidden space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">My Profile</h1>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="md:flex">
                            <div class="md:w-1/3 bg-gray-50 p-8 border-r">
                                <div class="text-center">
                                    <div class="inline-block p-6 rounded-full bg-blue-100 text-blue-600 mb-4">
                                        <i class="fas fa-user text-6xl"></i>
                                    </div>
                                    <h2 id="profile-name" class="text-2xl font-bold text-gray-800">Employee Name</h2>
                                    <p id="profile-position" class="text-gray-600">Position</p>
                                    <p id="profile-department" class="text-gray-600">Department</p>
                                </div>
                                <div class="mt-8 space-y-4">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Employee Code:</span>
                                        <span id="profile-code" class="font-semibold text-gray-800">EMP001</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Status:</span>
                                        <span id="profile-status" class="font-semibold text-green-600">Active</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Hiring Date:</span>
                                        <span id="profile-hiring-date" class="font-semibold text-gray-800">Jan 1, 2023</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Leave Balance:</span>
                                        <span id="profile-leave-balance" class="font-semibold text-blue-600">21 days</span>
                                    </div>
                                </div>
                            </div>
                            <div class="md:w-2/3 p-8">
                                <h3 class="text-xl font-semibold text-gray-800 mb-6">Personal Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <p class="text-sm text-gray-600">Full Name</p>
                                        <p id="profile-full-name" class="font-medium text-gray-800">John Doe</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Email</p>
                                        <p id="profile-email" class="font-medium text-gray-800">john.doe@example.com</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Phone</p>
                                        <p id="profile-phone" class="font-medium text-gray-800">+1 234 567 890</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Date of Birth</p>
                                        <p id="profile-dob" class="font-medium text-gray-800">Jan 1, 1990</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Gender</p>
                                        <p id="profile-gender" class="font-medium text-gray-800">Male</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Marital Status</p>
                                        <p id="profile-marital-status" class="font-medium text-gray-800">Single</p>
                                    </div>
                                    <div class="md:col-span-2">
                                        <p class="text-sm text-gray-600">Address</p>
                                        <p id="profile-address" class="font-medium text-gray-800">123 Main St, City, Country</p>
                                    </div>
                                </div>

                                <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-6">Employment Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <p class="text-sm text-gray-600">ID Number</p>
                                        <p id="profile-id-number" class="font-medium text-gray-800">ID12345678</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Social Insurance</p>
                                        <p id="profile-social-insurance" class="font-medium text-gray-800">SI12345678</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Level</p>
                                        <p id="profile-level" class="font-medium text-gray-800">Employee</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Direct Manager</p>
                                        <p id="profile-manager" class="font-medium text-gray-800">Jane Smith</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Faculty</p>
                                        <p id="profile-faculty" class="font-medium text-gray-800">Computer Science</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Graduation Year</p>
                                        <p id="profile-graduation-year" class="font-medium text-gray-800">2015</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- My Requests Section -->
                <section id="my-requests" class="hidden space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">My Requests</h1>

                    <!-- Tabs -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="border-b border-gray-200">
                            <nav class="flex -mb-px">
                                <button id="tab-my-leaves" class="py-4 px-6 text-center border-b-2 border-blue-500 font-medium text-sm text-blue-600 flex-1" onclick="switchMyRequestsTab('my-leaves')">
                                    Leaves
                                </button>
                                <button id="tab-my-excuses" class="py-4 px-6 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 flex-1" onclick="switchMyRequestsTab('my-excuses')">
                                    Excuses
                                </button>
                                <button id="tab-my-overtime" class="py-4 px-6 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 flex-1" onclick="switchMyRequestsTab('my-overtime')">
                                    Overtime
                                </button>
                            </nav>
                        </div>

                        <!-- My Leaves Tab -->
                        <div id="my-leaves-content" class="p-6 my-requests-tab-content">
                            <div class="flex justify-end mb-4">
                                <button id="add-my-leave-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                    <i class="fas fa-plus mr-1"></i> Request Leave
                                </button>
                            </div>

                            <!-- Leave Request Form - Hidden by default -->
                            <div id="my-leave-form-container" class="hidden mb-6">
                                <div class="bg-gray-50 p-6 rounded-lg border">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Submit Leave Request</h3>
                                    <form id="my-leave-form" class="space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label for="my-leave-start-date" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                                <input type="text" id="my-leave-start-date" required placeholder="Select start date" class="w-full p-2 border border-gray-300 rounded-md shadow-sm flatpickr-input">
                                            </div>
                                            <div>
                                                <label for="my-leave-end-date" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                                                <input type="text" id="my-leave-end-date" required placeholder="Select end date" class="w-full p-2 border border-gray-300 rounded-md shadow-sm flatpickr-input">
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label for="my-leave-days" class="block text-sm font-medium text-gray-700 mb-1">Number of Days</label>
                                                <select id="my-leave-days" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                                    <option value="0.5">Half Day</option>
                                                    <option value="1">1 Day</option>
                                                    <option value="2">2 Days</option>
                                                    <option value="3">3 Days</option>
                                                    <option value="4">4 Days</option>
                                                    <option value="5">5 Days</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="my-leave-type" class="block text-sm font-medium text-gray-700 mb-1">Leave Type</label>
                                                <select id="my-leave-type" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                                    <option value="annual">Annual Leave</option>
                                                    <option value="sick">Sick Leave</option>
                                                    <option value="unpaid">Unpaid Leave</option>
                                                    <option value="compensatory">Compensatory Leave</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="my-leave-reason" class="block text-sm font-medium text-gray-700 mb-1">Reason (Optional)</label>
                                            <textarea id="my-leave-reason" rows="3" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                        </div>
                                        <div class="flex justify-end space-x-3">
                                            <button type="button" id="cancel-my-leave-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                                Cancel
                                            </button>
                                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                                Submit Request
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Leave Balance Summary -->
                            <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                                <div class="flex flex-col md:flex-row justify-between items-center">
                                    <div class="mb-4 md:mb-0">
                                        <h3 class="text-lg font-medium text-blue-800">Your Leave Balance</h3>
                                        <p class="text-sm text-blue-600">Annual leave balance for the current year</p>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="text-4xl font-bold text-blue-700" id="my-leave-balance">21</div>
                                        <div class="ml-2 text-lg text-blue-600">days</div>
                                    </div>
                                </div>
                            </div>

                            <!-- My Leave Records Table -->
                            <div class="table-container">
                                <table id="myLeavesTable" class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-blue-600">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Start Date</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">End Date</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Days</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Type</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Reason</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Status</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="myLeavesTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- My Excuses Tab -->
                        <div id="my-excuses-content" class="p-6 my-requests-tab-content hidden">
                            <div class="flex justify-end mb-4">
                                <button id="add-my-excuse-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                    <i class="fas fa-plus mr-1"></i> Request Excuse
                                </button>
                            </div>

                            <!-- Excuse Request Form - Hidden by default -->
                            <div id="my-excuse-form-container" class="hidden mb-6">
                                <div class="bg-gray-50 p-6 rounded-lg border">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Submit Excuse Request</h3>
                                    <form id="my-excuse-form" class="space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label for="my-excuse-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                                <input type="text" id="my-excuse-date" required placeholder="Select date" class="w-full p-2 border border-gray-300 rounded-md shadow-sm flatpickr-input">
                                            </div>
                                            <div>
                                                <label for="my-excuse-start-time" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                                                <input type="text" id="my-excuse-start-time" required placeholder="Select start time" class="w-full p-2 border border-gray-300 rounded-md shadow-sm time-picker">
                                            </div>
                                            <div>
                                                <label for="my-excuse-end-time" class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                                                <input type="text" id="my-excuse-end-time" required placeholder="Select end time" class="w-full p-2 border border-gray-300 rounded-md shadow-sm time-picker">
                                            </div>
                                        </div>
                                        <div>
                                            <label for="my-excuse-hours" class="block text-sm font-medium text-gray-700 mb-1">Hours</label>
                                            <input type="number" id="my-excuse-hours" required min="0.5" max="8" step="0.5" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter hours">
                                        </div>
                                        <div>
                                            <label for="my-excuse-reason" class="block text-sm font-medium text-gray-700 mb-1">Reason</label>
                                            <textarea id="my-excuse-reason" rows="3" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                        </div>
                                        <div class="flex justify-end space-x-3">
                                            <button type="button" id="cancel-my-excuse-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                                Cancel
                                            </button>
                                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                                Submit Request
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- My Excuse Records Table -->
                            <div class="table-container">
                                <table id="myExcusesTable" class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-blue-600">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Date</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Start Time</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">End Time</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Hours</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Reason</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Status</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="myExcusesTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- My Overtime Tab -->
                        <div id="my-overtime-content" class="p-6 my-requests-tab-content hidden">
                            <div class="flex justify-end mb-4">
                                <button id="add-my-overtime-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                    <i class="fas fa-plus mr-1"></i> Request Overtime
                                </button>
                            </div>

                            <!-- Overtime Request Form - Hidden by default -->
                            <div id="my-overtime-form-container" class="hidden mb-6">
                                <div class="bg-gray-50 p-6 rounded-lg border">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Submit Overtime Request</h3>
                                    <form id="my-overtime-form" class="space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label for="my-overtime-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                                <input type="text" id="my-overtime-date" required placeholder="Select date" class="w-full p-2 border border-gray-300 rounded-md shadow-sm flatpickr-input">
                                            </div>
                                            <div>
                                                <label for="my-overtime-start-time" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                                                <input type="text" id="my-overtime-start-time" required placeholder="Select start time" class="w-full p-2 border border-gray-300 rounded-md shadow-sm time-picker">
                                            </div>
                                            <div>
                                                <label for="my-overtime-end-time" class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                                                <input type="text" id="my-overtime-end-time" required placeholder="Select end time" class="w-full p-2 border border-gray-300 rounded-md shadow-sm time-picker">
                                            </div>
                                        </div>
                                        <div>
                                            <label for="my-overtime-hours" class="block text-sm font-medium text-gray-700 mb-1">Hours</label>
                                            <input type="number" id="my-overtime-hours" required min="0.5" max="8" step="0.5" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter hours">
                                        </div>
                                        <div>
                                            <label for="my-overtime-reason" class="block text-sm font-medium text-gray-700 mb-1">Reason</label>
                                            <textarea id="my-overtime-reason" rows="3" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                        </div>
                                        <div class="flex justify-end space-x-3">
                                            <button type="button" id="cancel-my-overtime-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                                Cancel
                                            </button>
                                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                                Submit Request
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- My Overtime Records Table -->
                            <div class="table-container">
                                <table id="myOvertimeTable" class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-blue-600">
                                        <tr>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Date</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Start Time</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">End Time</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Hours</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Reason</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Status</th>
                                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider font-bold">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="myOvertimeTableBody" class="bg-white divide-y divide-gray-200">
                                        <!-- Will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Manager Dashboard Section -->
                <section id="manager-dashboard" class="hidden space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Manager Dashboard</h1>

                    <!-- Team Overview -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Team Overview</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                        <i class="fas fa-users text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-500">Team Members</p>
                                        <h3 id="team-members-count" class="text-xl font-semibold text-gray-800">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                                        <i class="fas fa-user-check text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-500">Present Today</p>
                                        <h3 id="team-present-count" class="text-xl font-semibold text-gray-800">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                        <i class="fas fa-calendar-alt text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm text-gray-500">On Leave Today</p>
                                        <h3 id="team-on-leave-count" class="text-xl font-semibold text-gray-800">0</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Team Members -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Team Members</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="team-members-container">
                            <!-- Team members will be populated here -->
                            <p class="text-gray-500 col-span-full text-center py-4">No team members found</p>
                        </div>
                    </div>

                    <!-- Pending Approvals -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Pending Approvals</h2>

                        <!-- Tabs -->
                        <div class="border-b border-gray-200 mb-4">
                            <ul class="flex flex-wrap -mb-px">
                                <li class="mr-2">
                                    <button id="tab-pending-leaves" class="inline-block py-2 px-4 text-blue-600 border-b-2 border-blue-600 font-medium" onclick="switchApprovalTab('pending-leaves')">
                                        Leaves <span id="pending-leaves-count" class="ml-1 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">0</span>
                                    </button>
                                </li>
                                <li class="mr-2">
                                    <button id="tab-pending-excuses" class="inline-block py-2 px-4 text-gray-500 hover:text-gray-700 font-medium" onclick="switchApprovalTab('pending-excuses')">
                                        Excuses <span id="pending-excuses-count" class="ml-1 px-2 py-0.5 bg-gray-100 text-gray-800 text-xs font-semibold rounded-full">0</span>
                                    </button>
                                </li>
                                <li>
                                    <button id="tab-pending-overtime" class="inline-block py-2 px-4 text-gray-500 hover:text-gray-700 font-medium" onclick="switchApprovalTab('pending-overtime')">
                                        Overtime <span id="pending-overtime-count" class="ml-1 px-2 py-0.5 bg-gray-100 text-gray-800 text-xs font-semibold rounded-full">0</span>
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <!-- Tab Content -->
                        <div id="pending-leaves-content" class="approval-tab-content">
                            <div id="pending-leaves-container" class="space-y-4">
                                <!-- Pending leave requests will be populated here -->
                                <p class="text-gray-500 text-center py-4">No pending leave requests</p>
                            </div>
                        </div>

                        <div id="pending-excuses-content" class="approval-tab-content hidden">
                            <div id="pending-excuses-container" class="space-y-4">
                                <!-- Pending excuse requests will be populated here -->
                                <p class="text-gray-500 text-center py-4">No pending excuse requests</p>
                            </div>
                        </div>

                        <div id="pending-overtime-content" class="approval-tab-content hidden">
                            <div id="pending-overtime-container" class="space-y-4">
                                <!-- Pending overtime requests will be populated here -->
                                <p class="text-gray-500 text-center py-4">No pending overtime requests</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="settings" class="hidden space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Settings</h1>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Change Password</h2>
                            <form id="password-form" class="space-y-4">
                                <div>
                                    <label for="current-password" class="block text-sm font-medium text-gray-700 mb-1">Current Password</label>
                                    <input type="password" id="current-password" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label for="new-password" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
                                    <input type="password" id="new-password" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
                                    <input type="password" id="confirm-password" required class="w-full p-2 border border-gray-300 rounded-md shadow-sm">
                                </div>
                                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                    Change Password
                                </button>
                            </form>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">Appearance</h2>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Theme</label>
                                    <div class="flex space-x-4">
                                        <button id="light-mode-btn" class="flex-1 bg-white border border-gray-300 rounded-md py-2 px-4 font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <i class="fas fa-sun mr-2"></i> Light
                                        </button>
                                        <button id="dark-mode-btn" class="flex-1 bg-gray-800 text-white border border-gray-700 rounded-md py-2 px-4 font-medium hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <i class="fas fa-moon mr-2"></i> Dark
                                        </button>
                                    </div>
                                </div>
                                <div class="pt-4 border-t space-y-4">
                                    <button id="reset-btn" onclick="clearLocalStorageAndReload()" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                        <i class="fas fa-sync mr-2"></i> Reset Data
                                    </button>
                                    <button id="logout-btn" onclick="logout()" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                                        <i class="fas fa-sign-out-alt mr-2"></i> Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Supabase Integration Script -->
    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://dyynskyqflewxcfvmdba.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5eW5za3lxZmxld3hjZnZtZGJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0MzE4OTgsImV4cCI6MjA2NDAwNzg5OH0.awjIjxd1XQIiVwRTFGmwBUT0gPJvCGI5nCbpGJvefEQ';

        // Initialize Supabase client
        let supabase;

        // Wait for Supabase script to load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Supabase client once the script is loaded
            if (typeof supabaseClient !== 'undefined') {
                supabase = supabaseClient.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('Supabase client initialized');
            } else {
                // Retry after a short delay if supabaseClient is not available yet
                setTimeout(() => {
                    if (typeof supabaseClient !== 'undefined') {
                        supabase = supabaseClient.createClient(SUPABASE_URL, SUPABASE_KEY);
                        console.log('Supabase client initialized (delayed)');
                    } else {
                        console.error('Failed to initialize Supabase client: supabaseClient not available');
                    }
                }, 1000);
            }
        });
    </script>

    <!-- Application Script -->
    <script>
        // Global variables
        let employees = [];
        let leaveRecords = [];
        let excuseRecords = [];
        let overtimeRecords = [];
        let penaltyRecords = [];
        let salaryRecords = [];
        let payrollRecords = [];
        let userAccounts = [];
        let departments = [];
        let positions = [];
        let managers = [];
        let currentUserRole = '';
        let currentUserId = '';
        let currentEmployeeId = '';
        let deptChartInstance = null;
        let levelChartInstance = null;
        let hiringChartInstance = null;
        let leavesDeptChartInstance = null;
        let genderChartInstance = null;
        let ageChartInstance = null;
        let monthlyHiringChartInstance = null;

        // --- Authentication Functions ---

        // Modified login handler to use Supabase authentication
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                // Sign in with Supabase
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: username,
                    password: password
                });
                
                if (error) {
                    console.error('Login error:', error.message);
                    document.getElementById('login-error').classList.remove('hidden');
                    return;
                }
                
                // Get user role from user_roles table
                const { data: roleData, error: roleError } = await supabase
                    .from('user_roles')
                    .select('role')
                    .eq('user_id', data.user.id)
                    .single();
                
                if (roleError) {
                    console.error('Error fetching user role:', roleError.message);
                    document.getElementById('login-error').classList.remove('hidden');
                    return;
                }
                
                // Set current user role and ID
                currentUserRole = roleData.role;
                currentUserId = data.user.id;
                
                // If user is an employee, get their employee ID
                if (currentUserRole === 'employee' || currentUserRole === 'manager') {
                    // Get employee ID from user metadata
                    const employeeEmail = data.user.email;
                    
                    const { data: employeeData, error: employeeError } = await supabase
                        .from('employees')
                        .select('id')
                        .eq('email', employeeEmail)
                        .single();
                    
                    if (!employeeError && employeeData) {
                        currentEmployeeId = employeeData.id;
                    } else {
                        console.error('Error fetching employee ID:', employeeError?.message);
                    }
                }
                
                console.log(`User logged in as ${currentUserRole}`);
                
                // Hide login screen and show app container
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                document.body.classList.add('flex', 'h-screen');
                
                // Initialize the application UI
                initializeAppUI();
                
            } catch (error) {
                console.error('Login error:', error.message);
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        // Modified logout function to use Supabase
        async function logout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) {
                    console.error('Logout error:', error.message);
                    return;
                }
                
                // Reset the user role and ID
                currentUserRole = '';
                currentUserId = '';
                
                document.getElementById('login-form').reset();
                document.getElementById('login-error').classList.add('hidden');
                document.getElementById('app-container').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
                document.body.classList.remove('flex', 'h-screen');
                
                // Destroy all chart instances
                if (deptChartInstance) deptChartInstance.destroy();
                if (levelChartInstance) levelChartInstance.destroy();
                if (hiringChartInstance) hiringChartInstance.destroy();
                if (leavesDeptChartInstance) leavesDeptChartInstance.destroy();
                if (genderChartInstance) genderChartInstance.destroy();
                if (ageChartInstance) ageChartInstance.destroy();
                if (monthlyHiringChartInstance) monthlyHiringChartInstance.destroy();
                deptChartInstance = levelChartInstance = hiringChartInstance = leavesDeptChartInstance = genderChartInstance = ageChartInstance = monthlyHiringChartInstance = null;
                
                console.log("User logged out");
            } catch (error) {
                console.error('Logout error:', error.message);
            }
        }

        // --- Data Loading Functions ---

        // Modified function to load data from Supabase instead of localStorage
        async function loadSavedData() {
            try {
                // Load employees
                const { data: employeesData, error: employeesError } = await supabase
                    .from('employees')
                    .select('*');
                
                if (employeesError) {
                    console.error('Error loading employees:', employeesError.message);
                } else {
                    employees = employeesData;
                    console.log(`Loaded ${employees.length} employees from Supabase`);
                }
                
                // Load leaves
                const { data: leavesData, error: leavesError } = await supabase
                    .from('leaves')
                    .select('*');
                
                if (leavesError) {
                    console.error('Error loading leaves:', leavesError.message);
                } else {
                    leaveRecords = leavesData;
                    console.log(`Loaded ${leaveRecords.length} leave records from Supabase`);
                }
                
                // Load excuses
                const { data: excusesData, error: excusesError } = await supabase
                    .from('excuses')
                    .select('*');
                
                if (excusesError) {
                    console.error('Error loading excuses:', excusesError.message);
                } else {
                    excuseRecords = excusesData;
                    console.log(`Loaded ${excuseRecords.length} excuse records from Supabase`);
                }
                
                // Load overtime
                const { data: overtimeData, error: overtimeError } = await supabase
                    .from('overtime')
                    .select('*');
                
                if (overtimeError) {
                    console.error('Error loading overtime:', overtimeError.message);
                } else {
                    overtimeRecords = overtimeData;
                    console.log(`Loaded ${overtimeRecords.length} overtime records from Supabase`);
                }
                
                // Load penalties
                const { data: penaltiesData, error: penaltiesError } = await supabase
                    .from('penalties')
                    .select('*');
                
                if (penaltiesError) {
                    console.error('Error loading penalties:', penaltiesError.message);
                } else {
                    penaltyRecords = penaltiesData;
                    console.log(`Loaded ${penaltyRecords.length} penalty records from Supabase`);
                }
                
                // Load salary
                const { data: salaryData, error: salaryError } = await supabase
                    .from('salary')
                    .select('*');
                
                if (salaryError) {
                    console.error('Error loading salary:', salaryError.message);
                } else {
                    salaryRecords = salaryData;
                    console.log(`Loaded ${salaryRecords.length} salary records from Supabase`);
                }
                
                // Load payroll
                const { data: payrollData, error: payrollError } = await supabase
                    .from('payroll')
                    .select('*');
                
                if (payrollError) {
                    console.error('Error loading payroll:', payrollError.message);
                } else {
                    payrollRecords = payrollData;
                    console.log(`Loaded ${payrollRecords.length} payroll records from Supabase`);
                }
            } catch (error) {
                console.error('Error loading data from Supabase:', error.message);
            }
        }

        // Function to migrate existing data from localStorage to Supabase
        async function migrateDataToSupabase() {
            try {
                console.log('Starting data migration to Supabase...');
                
                // Get data from localStorage
                const savedEmployees = localStorage.getItem('hrSystemEmployees');
                const savedLeaves = localStorage.getItem('hrSystemLeaves');
                const savedExcuses = localStorage.getItem('hrSystemExcuses');
                const savedOvertime = localStorage.getItem('hrSystemOvertime');
                const savedPenalties = localStorage.getItem('hrSystemPenalties');
                const savedSalary = localStorage.getItem('hrSystemSalary');
                const savedPayroll = localStorage.getItem('hrSystemPayroll');
                const savedUserAccounts = localStorage.getItem('hrSystemUserAccounts');
                
                let migrationResults = {
                    employees: 0,
                    leaves: 0,
                    excuses: 0,
                    overtime: 0,
                    penalties: 0,
                    salary: 0,
                    payroll: 0,
                    users: 0
                };
                
                // Migrate employees
                if (savedEmployees) {
                    const employees = JSON.parse(savedEmployees);
                    console.log(`Migrating ${employees.length} employees...`);
                    
                    for (const employee of employees) {
                        // Remove id to let Supabase generate a new one
                        const { id, ...employeeData } = employee;
                        
                        const { data, error } = await supabase
                            .from('employees')
                            .insert([employeeData])
                            .select();
                        
                        if (!error) migrationResults.employees++;
                    }
                }
                
                // Reload employees to get new IDs
                const { data: newEmployees, error: employeesError } = await supabase
                    .from('employees')
                    .select('*');
                
                if (employeesError) {
                    console.error('Error loading employees after migration:', employeesError.message);
                } else {
                    employees = newEmployees;
                }
                
                // Helper function to find new employee ID by code
                function findNewEmployeeId(empCode) {
                    const employee = employees.find(e => e.empCode === empCode);
                    return employee ? employee.id : null;
                }
                
                // Migrate leaves
                if (savedLeaves) {
                    const leaves = JSON.parse(savedLeaves);
                    console.log(`Migrating ${leaves.length} leave records...`);
                    
                    for (const leave of leaves) {
                        // Find the new employee ID
                        const employeeId = findNewEmployeeId(leave.employeeCode);
                        if (!employeeId) continue;
                        
                        // Create new leave record with new employee ID
                        const { id, employeeCode, ...leaveData } = leave;
                        
                        const { data, error } = await supabase
                            .from('leaves')
                            .insert([{ ...leaveData, employeeId }])
                            .select();
                        
                        if (!error) migrationResults.leaves++;
                    }
                }
                
                // Similar migrations for other data types...
                
                console.log('Data migration completed successfully!');
                console.log('Migration results:', migrationResults);
                
                return { 
                    success: true, 
                    message: 'Data migration completed successfully!',
                    results: migrationResults
                };
            } catch (error) {
                console.error('Error migrating data to Supabase:', error.message);
                return { success: false, message: error.message };
            }
        }

        // Add a button to migrate data from localStorage to Supabase
        function addMigrationButton() {
            const settingsSection = document.getElementById('settings');
            if (!settingsSection) return;
            
            const container = document.createElement('div');
            container.className = 'bg-white p-6 rounded-lg shadow mt-6';
            container.innerHTML = `
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Database Migration</h2>
                <div class="space-y-4">
                    <p class="text-gray-600">Migrate your data from local storage to Supabase database.</p>
                    <button id="migrate-data-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-md shadow transition duration-150">
                        <i class="fas fa-database mr-2"></i> Migrate Data to Supabase
                    </button>
                    <div id="migration-status" class="text-sm text-gray-600 hidden"></div>
                </div>
            `;
            
            settingsSection.appendChild(container);
            
            // Add event listener for migration button
            document.getElementById('migrate-data-btn').addEventListener('click', async function() {
                const statusElement = document.getElementById('migration-status');
                statusElement.classList.remove('hidden', 'text-green-600', 'text-red-600');
                statusElement.classList.add('text-blue-600');
                statusElement.textContent = 'Migration in progress... Please wait.';
                
                const result = await migrateDataToSupabase();
                
                if (result.success) {
                    statusElement.classList.remove('text-blue-600');
                    statusElement.classList.add('text-green-600');
                    statusElement.textContent = result.message;
                } else {
                    statusElement.classList.remove('text-blue-600');
                    statusElement.classList.add('text-red-600');
                    statusElement.textContent = `Migration failed: ${result.message}`;
                }
            });
        }

        // Call this function after the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Add migration button to settings page
            setTimeout(addMigrationButton, 1000);
        });
    </script>
</body>
</html>
